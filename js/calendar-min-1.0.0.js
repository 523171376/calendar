var WC=function(){var t=this;return this.selecter,this.toolbar,this.monthContanier,this.contanier,this.root,this.data,this.dayClick,this.roomClick,this.setSelecter=function(){t.selecter=arguments[0],t.toolbar=arguments[1],t.root=$("#"+arguments[0]),t.contanier=$("#"+arguments[0]).find(".body"),t.monthContanier=$("#"+arguments[1]).find(".month"),t.nextMonth=$("#"+arguments[3]),t.preMonth=$("#"+arguments[2])},this.setcall=function(){t.dayClick=arguments[0],t.roomClick=arguments[1]},this.render=function(a){var n=a||new Date,e=n.getFullYear(),i=n.getMonth()+1,o=!(3&e||!(e%100))&&[0,31,29,31,30,31,30,31,31,30,31,30,31]||[0,31,28,31,30,31,30,31,31,30,31,30,31],r=o[i],d=o[1==i?12:i-1],c=new Date(e+"/"+i+"/1").getUTCDay()+1,l=t.buildHTML(r,d,c,e,i);t.contanier.html(l),t.monthContanier.html(e+"年"+i+"月"),t.monthContanier.data("month",e+"/"+i+"/1")},this.isWeekend=function(t){return 6===new Date(t).getUTCDay()+1||7===new Date(t).getUTCDay()+1},this.buildHTML=function(a,n,e,i,o){for(var r="",d=n-e+1,c=0,l=1,s=!1,h=1;h<=10;h++){r+='<div class="row"><table><tbody><tr>';for(var u=1;u<=7;u++){var m="day",y=i+"-"+o+"-"+l;t.isWeekend(i+"/"+o+"/"+l)&&(m="day weekend"),t.data[y]&&(m=("3"===t.data[y].type?"day holiday":"4"===t.data[y].type&&"day work")||m);var f="";t.data[y]&&(f=t.getDataHtml(y)),r+=1===h?u<e?'<td class="uncurrent" data-day="'+y+'"><i class="day">'+ ++d+"</i></td>":'<td class="current" data-day="'+y+'"><i class="'+m+'">'+l+"</i>"+f+"</td>":l>a?'<td class="uncurrent" data-day="'+y+'"><i class="day">'+ ++c+"</i></td>":'<td class="current" data-day="'+y+'"><i class="'+m+'">'+l+"</i>"+f+"</td>",l==a&&(s=!0),1===h&&u<e||l++}if(r+="</tr></tbody></table></div>",s)break}return r},this.startLoading=function(){for(var a='<div class="wc_loading"><span><ul>',n=0;n<15;n++)a+="<li></li>";a+="</ul><i>加载中...</i></span></div>",t.root.append(a),t.nextMonth.attr("disabled","true"),t.preMonth.attr("disabled","true")},this.endLoading=function(){t.root.find(".wc_loading").remove(),t.nextMonth.removeAttr("disabled"),t.preMonth.removeAttr("disabled")},this.bindFn=function(a,n){t.preMonth.click(function(){t.startLoading();var n=new Date(t.monthContanier.data("month"));n.setMonth(n.getMonth()-1),a.call.call(a.call.this,n)}),t.nextMonth.click(function(){t.startLoading();var a=new Date(t.monthContanier.data("month"));a.setMonth(a.getMonth()+1),n.call.call(n.call.this,a)}),this.contanier.on("click",".row table tbody tr td.current",function(a){$(".row table tbody tr td.current").removeClass("checked"),$(this).addClass("checked");var n=t.data[$(this).data("day")]||{};t.dayClick.call(t.dayClick.this,n),a.stopPropagation(),a.preventDefault()}),this.contanier.on("click",".row table tbody tr td .intd-content div span ul li",function(a){var n=t.data[$(this).parents("td").data("day")],e={};n&&(e=n.room[$(this).parents("span").data("index")].meetting[$(this).data("index")]),t.roomClick.call(t.roomClick.this,e),a.stopPropagation(),a.preventDefault()})},this.getYM=function(t){return t.getFullYear()+"-"+(t.getMonth()+1)},this.cacheData=function(a){var n={};$(a).each(function(t,a){n[a.day]=a}),t.data=n},this.getDataHtml=function(a){var n=t.data[a];if(!n.room)return"";var e='<div class="intd-content">',i="<div>",o="<div>",r=0;return $(n.room).each(function(a,n){"1"===n.type&&(r++,i+=t.getMeetHtml(n.meetting,r,a))}),$(n.room).each(function(a,n){"2"===n.type&&(r++,o+=t.getMeetHtml(n.meetting,r,a))}),e+=(i+="</div>")+(o+="</div>")+"</div>"},this.getMeetHtml=function(t,a,n){var e='<span data-index="'+n+'"><i class="bg-num">'+a+"</i><ul>",i=3===t.length?"more":"",o="",r="",d="";return $(t).each(function(t,a){var n="0"===a.booked?"free":"book-mine",e='<li class="'+i+" "+n+'" data-index="'+t+'"></li>';o="1"===a.type&&e||o,r="2"===a.type&&e||r,d="3"===a.type&&e||d}),e+=o+r+d,e+="</ul></span>"},{calender:{init:function(a){t.setSelecter(a.selecter,a.toolbar,a.preMonth.btn,a.nextMonth.btn),t.setcall(a.dayClick,a.roomClick),t.cacheData(a.currentData),t.render(),t.bindFn(a.preMonth,a.nextMonth)},load:function(a,n){t.cacheData(a),t.render(n),t.endLoading()}}}}();